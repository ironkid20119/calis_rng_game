<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>calis rng</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Balthazar:wght@400;700&display=swap');

      body {
        font-family: 'Balthazar', serif;
        margin: 0;
        padding: 0;
        background: #6a0dad;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      .game-container {
        background: #2c2c2c;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        min-width: 350px;
        max-width: 900px;
      }

      button {
        padding: 10px 20px;
        margin: 5px;
        font-size: 16px;
        cursor: pointer;
        background-color: #c71585;
        color: #fff;
        border: none;
        border-radius: 5px;
        transition: background-color 0.3s;
        font-family: 'Balthazar', serif;
        font-weight: 700;
      }

      button:disabled {
        background-color: #555;
        cursor: not-allowed;
      }

      button:hover:not(:disabled) {
        background-color: #e754bb;
      }

      #results {
        margin-top: 20px;
        white-space: pre-line;
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 5px;
        min-height: 100px;
        font-family: 'Balthazar', serif;
      }

      .bold {
        font-weight: 700;
      }

      .roll-line {
        margin: 5px 0;
      }

      .rank-button {
        background: none;
        border: 2px solid #28a745;
        color: inherit;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 3px;
        font-family: 'Balthazar', serif;
        transition: all 0.2s;
        display: inline;
      }

      .rank-button:hover {
        background-color: rgba(40, 167, 69, 0.2);
        border-color: #34d058;
      }

      .rank-button.accepted {
        opacity: 0.3;
        cursor: default;
        border-color: #555;
      }

      .rank-button.accepted:hover {
        background: none;
        border-color: #555;
      }

      .inventory-section {
        margin-top: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
      }

      .inventory-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        margin-top: 15px;
      }

      .inventory-slot {
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid #555;
        border-radius: 5px;
        padding: 10px;
        min-height: 60px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .inventory-slot:hover {
        background: rgba(0, 0, 0, 0.5);
        border-color: #888;
      }

      .inventory-slot.empty {
        cursor: default;
        opacity: 0.5;
      }

      .inventory-slot.empty:hover {
        background: rgba(0, 0, 0, 0.3);
        border-color: #555;
      }

      .slot-variants {
        font-size: 10px;
        margin-bottom: 3px;
        color: #ffd700;
      }

      .slot-value {
        font-weight: 700;
        margin-bottom: 3px;
      }

      .slot-rank {
        font-size: 11px;
        opacity: 0.8;
      }

      .index-section {
        margin-top: 30px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
        max-height: 400px;
        overflow-y: auto;
      }

      .index-category {
        margin-bottom: 20px;
        text-align: left;
      }

      .index-category h3 {
        margin-bottom: 10px;
        color: #c71585;
      }

      .index-item {
        padding: 5px;
        margin: 3px 0;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 3px;
      }

      .index-item.discovered {
        color: #4ade80;
      }

      .index-item.undiscovered {
        color: #666;
      }

      #toggleIndex {
        margin-top: 10px;
        background-color: #6a0dad;
      }

      #toggleIndex:hover {
        background-color: #8a2dcd;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <h1>calis rng game</h1>
      <button id="rollOnceBtn">Roll Once</button>
      <button id="rollMultipleBtn">Roll 15 Times</button>
      <button id="toggleIndex">Toggle Index</button>

      <div id="results"></div>

      <div class="inventory-section">
        <h2>Inventory (25 slots)</h2>
        <div class="inventory-grid" id="inventoryGrid"></div>
      </div>

      <div class="index-section" id="indexSection" style="display: none;">
        <h2>Discovery Index</h2>
        <div id="indexContent"></div>
      </div>
    </div>

    <script>
      const resultsDiv = document.getElementById('results');
      const rollOnceBtn = document.getElementById('rollOnceBtn');
      const rollMultipleBtn = document.getElementById('rollMultipleBtn');
      const toggleIndexBtn = document.getElementById('toggleIndex');
      const indexSection = document.getElementById('indexSection');
      const indexContent = document.getElementById('indexContent');
      const inventoryGrid = document.getElementById('inventoryGrid');
      let isCooldown = false;
      let multiRolls = [];
      let inventory = [];
      let discovered = { ranks: [], specialRanks: [], secretRanks: [], variants: [] };
      const MAX_SLOTS = 25;
      let lastClickTime = {};

      // All possible ranks, special ranks, secret ranks, and variants
      const ALL_RANKS = ['nothing', 'Common', 'Natural', 'Rare', 'Unnatural', 'Epic', 'Decent', 'Mythical', 'Legendary', 'Unreal', 'Super Rare', 'Eternal', 'Starstruck', 'Paradoxical', 'Iridescent', 'Lux', 'Possible', 'RNGesus', 'CRAZY', 'Supreme', 'DAMN', 'Stupiditium', 'ASCENDED', 'Obscure', 'INFINITE', 'Divine', 'Insurmountable', 'GRAND', 'what.', 'FINALE'];
      
      const ALL_SPECIAL_RANKS = ['In im table ?!?!?', '???UNKNOWN???', 'leaflet', 'nil', 'NOTHINGNESS', 'INSANE', 'Lmao', 'PERFECTIONIST', 'Imaginary', 'NICE', 'FUNNY', 'Common : DIVINITY', 'Legacy FINALE', 'Catastrophic', '<(ETERNAL DAWN)>'];
      
      const ALL_SECRET_RANKS = ['üêü', 'Destiny', 'üå≥', 'ULTIMATE'];
      
      const ALL_VARIANTS = ['shiny', 'golden', 'inverse', 'retro', 'bright', 'cosmic', 'GIGANTIC', 'h o r s e', 'eternal', 'dark', 'UNIVERSAL', 'Modified', 'Colorful', 'Gigaconfuscibretrationiminousis', 'Possible'];

      // Load discovered items
      function loadDiscovered() {
        const saved = localStorage.getItem('calisRngDiscovered');
        if (saved) {
          try {
            discovered = JSON.parse(saved);
            // Add secretRanks if it doesn't exist (for backwards compatibility)
            if (!discovered.secretRanks) {
              discovered.secretRanks = [];
            }
          } catch (e) {
            discovered = { ranks: [], specialRanks: [], secretRanks: [], variants: [] };
          }
        }
      }

      // Save discovered items
      function saveDiscovered() {
        localStorage.setItem('calisRngDiscovered', JSON.stringify(discovered));
      }

      // Mark as discovered
      function markDiscovered(type, name) {
        if (!discovered[type].includes(name)) {
          discovered[type].push(name);
          saveDiscovered();
        }
      }

      // Render index
      function renderIndex() {
        let html = '<div class="index-category"><h3>Variants</h3>';
        ALL_VARIANTS.forEach(v => {
          const isDiscovered = discovered.variants.includes(v);
          const icon = isDiscovered ? '‚úì' : '‚úó';
          const className = isDiscovered ? 'discovered' : 'undiscovered';
          html += `<div class="index-item ${className}">${icon} ${v}</div>`;
        });
        html += '</div>';

        html += '<div class="index-category"><h3>Special Ranks</h3>';
        ALL_SPECIAL_RANKS.forEach(r => {
          const isDiscovered = discovered.specialRanks.includes(r);
          const icon = isDiscovered ? '‚úì' : '‚úó';
          const className = isDiscovered ? 'discovered' : 'undiscovered';
          html += `<div class="index-item ${className}">${icon} ${r}</div>`;
        });
        html += '</div>';

        html += '<div class="index-category"><h3>Secret Ranks</h3>';
        ALL_SECRET_RANKS.forEach(r => {
          const isDiscovered = discovered.secretRanks.includes(r);
          const icon = isDiscovered ? '‚úì' : '‚úó';
          const className = isDiscovered ? 'discovered' : 'undiscovered';
          html += `<div class="index-item ${className}">${icon} ${r}</div>`;
        });
        html += '</div>';

        html += '<div class="index-category"><h3>Ranks</h3>';
        ALL_RANKS.forEach(r => {
          const isDiscovered = discovered.ranks.includes(r);
          const icon = isDiscovered ? '‚úì' : '‚úó';
          const className = isDiscovered ? 'discovered' : 'undiscovered';
          html += `<div class="index-item ${className}">${icon} ${r}</div>`;
        });
        html += '</div>';

        indexContent.innerHTML = html;
      }

      toggleIndexBtn.addEventListener('click', () => {
        if (indexSection.style.display === 'none') {
          indexSection.style.display = 'block';
          renderIndex();
        } else {
          indexSection.style.display = 'none';
        }
      });

      // Load inventory from localStorage
      function loadInventory() {
        const saved = localStorage.getItem('calisRngInventory');
        if (saved) {
          try {
            inventory = JSON.parse(saved);
          } catch (e) {
            inventory = [];
          }
        } else {
          inventory = [];
        }
        renderInventory();
      }

      // Save inventory to localStorage
      function saveInventory() {
        localStorage.setItem('calisRngInventory', JSON.stringify(inventory));
        renderInventory();
      }

      // Render inventory grid
      function renderInventory() {
        inventoryGrid.innerHTML = '';
        for (let i = 0; i < MAX_SLOTS; i++) {
          const slot = document.createElement('div');
          slot.className = 'inventory-slot';
          
          if (inventory[i]) {
            const item = inventory[i];
            slot.className = 'inventory-slot';
            
            if (item.variants) {
              const varDiv = document.createElement('div');
              varDiv.className = 'slot-variants';
              varDiv.textContent = item.variants;
              slot.appendChild(varDiv);
            }
            
            const valueDiv = document.createElement('div');
            valueDiv.className = 'slot-value';
            valueDiv.style.color = item.color;
            valueDiv.textContent = item.displayValue;
            slot.appendChild(valueDiv);
            
            const rankDiv = document.createElement('div');
            rankDiv.className = 'slot-rank';
            rankDiv.textContent = item.rank;
            slot.appendChild(rankDiv);
            
            slot.onclick = () => deleteItem(i);
          } else {
            slot.className = 'inventory-slot empty';
            slot.textContent = 'Empty';
          }
          
          inventoryGrid.appendChild(slot);
        }
      }

      // Delete item on double click
      function deleteItem(index) {
        const now = Date.now();
        const key = `slot_${index}`;
        
        if (lastClickTime[key] && now - lastClickTime[key] < 1000) {
          inventory.splice(index, 1);
          saveInventory();
          lastClickTime[key] = 0;
        } else {
          lastClickTime[key] = now;
        }
      }

      // Add to inventory
      function addToInventory(item, buttonId) {
        if (!item) return;
        if (inventory.length >= MAX_SLOTS) {
          alert('Inventory full! Delete items to make space.');
          return;
        }
        
        inventory.push(item);
        saveInventory();
        
        const btn = document.getElementById(buttonId);
        if (btn) {
          btn.classList.add('accepted');
          btn.onclick = null;
        }
      }

      // Accept from roll
      function acceptRoll(index) {
        addToInventory(multiRolls[index], `rank-btn-${index}`);
      }

      window.acceptRoll = acceptRoll;

      function setCooldown(duration) {
        if (isCooldown) return;
        isCooldown = true;
        rollOnceBtn.disabled = true;
        rollMultipleBtn.disabled = true;
        let remaining = duration / 1000;
        const originalText1 = rollOnceBtn.textContent;
        const originalText2 = rollMultipleBtn.textContent;

        const interval = setInterval(() => {
          rollOnceBtn.textContent = `Cooldown: ${remaining.toFixed(1)}s`;
          rollMultipleBtn.textContent = `Cooldown: ${remaining.toFixed(1)}s`;
          remaining -= 0.1;
          if (remaining <= 0) {
            clearInterval(interval);
            rollOnceBtn.disabled = false;
            rollMultipleBtn.disabled = false;
            rollOnceBtn.textContent = originalText1;
            rollMultipleBtn.textContent = originalText2;
            isCooldown = false;
          }
        }, 100);
      }

      function getColor(value) {
        if (value < 100000) return 'white';
        if (value < 10000000) return 'gold';
        if (value < 1000000000) return 'cyan';
        if (value < 1000000000000) return 'purple';
        if (value < 1000000000000000) return 'green';
        return 'red';
      }

      function rollOnce() {
        let isSpecial = false;
        let auraCooldown = false;
        let isNegative = false;
        let isReverted = false;

        // Legacy FINALE 1/25,000,000
        if (Math.random() < 1 / 25000000) {
          isSpecial = true;
          markDiscovered('specialRanks', 'Legacy FINALE');
          const invData = {
            variants: '',
            displayValue: '1.0000e+10',
            rank: 'Legacy FINALE',
            color: 'gold'
          };
          return { result: '<span class="bold" style="color: gold;">You rolled a/an RANKBUTTON (1.0000e+10)!</span>', cooldown: 5000, inventoryData: invData };
        }

        // <(ETERNAL DAWN)> 1/10,000,000
        if (Math.random() < 1 / 10000000) {
          isSpecial = true;
          markDiscovered('specialRanks', '<(ETERNAL DAWN)>');
          const invData = {
            variants: '',
            displayValue: '-777,777,777.78',
            rank: '<(ETERNAL DAWN)>',
            color: 'purple'
          };
          return { result: '<span class="bold" style="color: purple;">You rolled a/an RANKBUTTON (-777,777,777.78)!</span>', cooldown: 4500, inventoryData: invData };
        }

        // Catastrophic 1/390625
        if (Math.random() < 1 / 390625) {
          isSpecial = true;
          markDiscovered('specialRanks', 'Catastrophic');
          const invData = {
            variants: '',
            displayValue: '-0.50',
            rank: 'Catastrophic',
            color: 'red'
          };
          return { result: '<span class="bold" style="color: red;">You rolled a/an RANKBUTTON (-0.50)!</span>', cooldown: 3500, inventoryData: invData };
        }

        // Ultra rare 1/75k
        if (Math.random() < 1 / 75000) {
          isSpecial = true;
          auraCooldown = true;
          markDiscovered('specialRanks', 'In im table ?!?!?');
          const invData = {
            variants: '',
            displayValue: '1einf',
            rank: 'In im table ?!?!?',
            color: 'white'
          };
          return { result: '<span class="bold">You rolled a/an RANKBUTTON (1einf)!</span>', cooldown: 2500, inventoryData: invData };
        }

        // Ultra rare unknown 1/1234567
        if (Math.random() < 1 / 1234567) {
          isSpecial = true;
          markDiscovered('specialRanks', '???UNKNOWN???');
          const invData = {
            variants: '',
            displayValue: '???',
            rank: '???UNKNOWN???',
            color: 'white'
          };
          return { result: '<span class="bold">You rolled a/an RANKBUTTON (???)!</span>', cooldown: 2500, inventoryData: invData };
        }

        // Leaflet 1/2763
        if (Math.random() < 1 / 2763) {
          isSpecial = true;
          markDiscovered('specialRanks', 'leaflet');
          const invData = {
            variants: '',
            displayValue: '2,763.00',
            rank: 'leaflet',
            color: 'lightgreen'
          };
          return { result: '<span class="bold" style="color: lightgreen;">You rolled a/an RANKBUTTON (2,763.00)!</span>', cooldown: 2763, inventoryData: invData };
        }

        let base = Math.random();
        let skewed;
        if (base < 0.7) skewed = 1 + Math.random() * 9;
        else if (base < 0.9) skewed = 10 + Math.random() * 40;
        else if (base < 0.99) skewed = 50 + Math.random() * 450;
        else skewed = 500 + Math.random() * 9500;

        skewed = Math.max(1, skewed);
        if (Math.random() < 1 / 1000) skewed = -1;

        // NEGATIVE chance
        if (skewed > 1 && Math.random() < 0.075) {
          skewed = -skewed;
          isNegative = true;
        }

        // REVERTED chance
        if (Math.random() < 1 / 75 && skewed !== 0 && skewed !== -1) {
          const originalValue = skewed;
          skewed = 1 / skewed;
          isReverted = true;
          var revertedOriginal = originalValue;
        }

        const baseValue = skewed;
        const absBaseValue = Math.abs(baseValue);

        // VARIANT system
        const variants = [
          { name: 'shiny', chance: 1 / 100, multiplier: 100 },
          { name: 'Modified', chance: 1 / 250, multiplier: 250 },
          { name: 'golden', chance: 1 / 500, multiplier: 500 },
          { name: 'Colorful', chance: 1 / 777, multiplier: 777 },
          { name: 'inverse', chance: 1 / 1000, multiplier: 1000 },
          { name: 'retro', chance: 1 / 2500, multiplier: 2500 },
          { name: 'bright', chance: 1 / 5000, multiplier: 5000 },
          { name: 'cosmic', chance: 1 / 10000, multiplier: 10000 },
          { name: 'GIGANTIC', chance: 1 / 25000, multiplier: 25000 },
          { name: 'h o r s e', chance: 1 / 30000, multiplier: 1 / 10 },
          { name: 'eternal', chance: 1 / 50000, multiplier: 50000 },
          { name: 'dark', chance: 1 / 77777, multiplier: 77777 },
          { name: 'UNIVERSAL', chance: 1 / 100000, multiplier: 100000 },
          { name: 'Possible', chance: 1 / 500000, multiplier: 500000 },
          { name: 'Gigaconfuscibretrationiminousis', chance: 1 / 1000000, multiplier: 1000000 }
        ];

        let variantText = '';
        let variantMultiplier = 1;
        let discoveredVariants = [];

        variants.forEach(v => {
          if (Math.random() < v.chance) {
            variantMultiplier *= v.multiplier;
            variantText += `[${v.name.toUpperCase()}] `;
            discoveredVariants.push(v.name);
            markDiscovered('variants', v.name);
          }
        });

        // Determine rank based ONLY on baseValue
        let rank = '';
        let displayValue = baseValue;

        // Special ranks
        if (Math.random() < 1 / 98900) { 
          rank = 'INSANE'; 
          displayValue = 0.989; 
          isSpecial = true;
          markDiscovered('specialRanks', 'INSANE');
        }
        else if (Math.random() < 1 / 1500) { 
          rank = 'Lmao'; 
          displayValue = 0.1; 
          isSpecial = true;
          markDiscovered('specialRanks', 'Lmao');
        }
        else if (Math.abs(baseValue - 5000) < 0.01) { 
          rank = 'PERFECTIONIST'; 
          isSpecial = true;
          markDiscovered('specialRanks', 'PERFECTIONIST');
        }
        else if (Math.random() < 1 / 8888) { 
          rank = "Imaginary"; 
          displayValue = "0.1i"; 
          isSpecial = true;
          markDiscovered('specialRanks', 'Imaginary');
        }
        else if (baseValue === -1) { 
          if (Math.random() < 1 / 25) {
            rank = 'NOTHINGNESS';
            displayValue = '-error';
            isSpecial = true;
            auraCooldown = true;
            markDiscovered('specialRanks', 'NOTHINGNESS');
          } else {
            rank = 'nil'; 
            isSpecial = true; 
            auraCooldown = true;
            markDiscovered('specialRanks', 'nil');
          }
        }
        else if (Math.abs(baseValue - 1) < 0.0001) {
          rank = 'nothing';
          markDiscovered('ranks', 'nothing');
        }
        else if (absBaseValue >= 69 && absBaseValue <= 69.001) { 
          rank = 'NICE'; 
          isSpecial = true; 
          auraCooldown = true;
          markDiscovered('specialRanks', 'NICE');
        }
        else if (absBaseValue >= 69420 && absBaseValue <= 69420.001) { 
          rank = 'FUNNY'; 
          isSpecial = true; 
          auraCooldown = true;
          markDiscovered('specialRanks', 'FUNNY');
        }
        else if (absBaseValue < 5) {
          if (Math.random() < 1 / 33333) { 
            rank = 'Common : DIVINITY'; 
            displayValue *= 5e5; 
            isSpecial = true;
            markDiscovered('specialRanks', 'Common : DIVINITY');
          }
          else { 
            rank = 'Common';
            markDiscovered('ranks', 'Common');
          }
        }
        else if (absBaseValue < 25) { rank = 'Natural'; markDiscovered('ranks', 'Natural'); }
        else if (absBaseValue < 50) { rank = 'Rare'; markDiscovered('ranks', 'Rare'); }
        else if (absBaseValue < 100) { rank = 'Unnatural'; markDiscovered('ranks', 'Unnatural'); }
        else if (absBaseValue < 250) { rank = 'Epic'; markDiscovered('ranks', 'Epic'); }
        else if (absBaseValue < 500) { rank = 'Decent'; markDiscovered('ranks', 'Decent'); }
        else if (absBaseValue < 1000) { rank = 'Mythical'; markDiscovered('ranks', 'Mythical'); }
        else if (absBaseValue < 5000) { rank = 'Legendary'; markDiscovered('ranks', 'Legendary'); }
        else if (absBaseValue < 10000) { rank = 'Unreal'; markDiscovered('ranks', 'Unreal'); }
        else if (absBaseValue < 50000) { rank = 'Super Rare'; markDiscovered('ranks', 'Super Rare'); }
        else if (absBaseValue < 100000) { rank = 'Eternal'; markDiscovered('ranks', 'Eternal'); }
        else if (absBaseValue < 500000) { rank = 'Starstruck'; markDiscovered('ranks', 'Starstruck'); }
        else if (absBaseValue < 1000000) { rank = 'Paradoxical'; markDiscovered('ranks', 'Paradoxical'); }
        else if (absBaseValue < 5000000) { rank = 'Iridescent'; markDiscovered('ranks', 'Iridescent'); }
        else if (absBaseValue < 10000000) { rank = 'Lux'; markDiscovered('ranks', 'Lux'); }
        else if (absBaseValue < 50000000) { rank = 'Possible'; markDiscovered('ranks', 'Possible'); }
        else if (absBaseValue < 100000000) { rank = 'RNGesus'; markDiscovered('ranks', 'RNGesus'); }
        else if (absBaseValue < 250000000) { rank = 'CRAZY'; markDiscovered('ranks', 'CRAZY'); }
        else if (absBaseValue < 1000000000) { rank = 'Supreme'; markDiscovered('ranks', 'Supreme'); }
        else if (absBaseValue < 1e10) { rank = 'DAMN'; markDiscovered('ranks', 'DAMN'); }
        else if (absBaseValue < 1e12) { rank = 'Stupiditium'; markDiscovered('ranks', 'Stupiditium'); }
        else if (absBaseValue < 1e15) { rank = 'ASCENDED'; markDiscovered('ranks', 'ASCENDED'); }
        else if (absBaseValue < 1e18) { rank = 'Obscure'; markDiscovered('ranks', 'Obscure'); }
        else if (absBaseValue < 1e21) { rank = 'INFINITE'; markDiscovered('ranks', 'INFINITE'); }
        else if (absBaseValue < 1e30) { rank = 'Divine'; markDiscovered('ranks', 'Divine'); }
        else if (absBaseValue < 1e50) { rank = 'Insurmountable'; markDiscovered('ranks', 'Insurmountable'); }
        else if (absBaseValue < 1e75) { rank = 'GRAND'; markDiscovered('ranks', 'GRAND'); }
        else if (absBaseValue < 1e100) { rank = 'what.'; markDiscovered('ranks', 'what.'); }
        else { rank = 'FINALE'; markDiscovered('ranks', 'FINALE'); }

        let dispValue;
        if (typeof displayValue === 'number') {
          if (isReverted) {
            const exponent = Math.floor(Math.log10(Math.abs(displayValue)));
            const mantissa = Math.abs(displayValue) / Math.pow(10, exponent);
            dispValue = `${mantissa.toFixed(2)}e${exponent}`;
          } else if (Math.abs(displayValue) >= 1e12) {
            dispValue = displayValue.toExponential(4);
          } else if (Math.abs(displayValue) >= 1000) {
            dispValue = displayValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
          } else {
            dispValue = displayValue.toFixed(2);
          }
        } else {
          dispValue = displayValue;
        }

        // Apply variant multiplier only to numeric display values
        if (typeof displayValue !== 'string' && variantMultiplier !== 1) {
          displayValue = displayValue * variantMultiplier;
          const absDisplayValue = Math.abs(displayValue);
          
          if (isReverted) {
            const exponent = Math.floor(Math.log10(Math.abs(displayValue)));
            const mantissa = Math.abs(displayValue) / Math.pow(10, exponent);
            dispValue = `${mantissa.toFixed(2)}e${exponent}`;
          } else if (Math.abs(displayValue) >= 1e12) {
            dispValue = displayValue.toExponential(4);
          } else if (Math.abs(displayValue) >= 1000) {
            dispValue = displayValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
          } else {
            dispValue = displayValue.toFixed(2);
          }
        }
        
        const absDisplayValue = typeof displayValue === 'number' ? Math.abs(displayValue) : 0;

        let result = '';
        let invVariants = '';
        if (variantText) {
          result += variantText;
          invVariants = variantText.trim();
        }
        if (isNegative) result += '[NEGATIVE] ';
        if (isReverted) result += '[REVERTED] ';
        const color = getColor(absDisplayValue);

        // Create clickable rank for inventory
        const rankButton = `<button class="rank-button" id="rank-btn-ROLLINDEX" onclick="acceptRoll(ROLLINDEX)">${rank}</button>`;

        if (['Lmao','FUNNY','NICE','nil','NOTHINGNESS','PERFECTIONIST','In im table ?!?!?','INSANE','Common : DIVINITY','Imaginary','???UNKNOWN???','Legacy FINALE','Catastrophic','<(ETERNAL DAWN)>'].includes(rank)) {
          result += `<span class="bold" style="color:${color};">You rolled a/an RANKBUTTON (${dispValue})!</span>`;
        } else {
          result += `<span style="color:${color};">You rolled a/an ${dispValue} RANKBUTTON!</span>`;
        }

        // Cooldown based on display value (with variants)
        let cooldown = 0;
        if (isSpecial) cooldown = 2500;
        else if (absDisplayValue >= 1e6) cooldown = 4000;
        else if (absDisplayValue >= 1e5) cooldown = 2000;
        else if (absDisplayValue >= 1e4) cooldown = 1000;

        const inventoryData = {
          variants: invVariants,
          displayValue: dispValue,
          rank: rank,
          color: color
        };

        return { result, cooldown, inventoryData };
      }

      rollOnceBtn.addEventListener('click', () => {
        if (isCooldown) return;
        multiRolls = [];
        const roll = rollOnce();
        multiRolls.push(roll.inventoryData);
        
        let displayResult = roll.result.replace(/ROLLINDEX/g, '0').replace(/RANKBUTTON/g, roll.inventoryData ? 
          `<button class="rank-button" id="rank-btn-0" onclick="acceptRoll(0)">${roll.inventoryData.rank}</button>` : 
          roll.inventoryData ? roll.inventoryData.rank : '???');
        
        resultsDiv.innerHTML = displayResult;
        if (roll.cooldown > 0) setCooldown(roll.cooldown);
      });

      rollMultipleBtn.addEventListener('click', () => {
        if (isCooldown) return;
        let maxCooldown = 0;
        let output = '';
        multiRolls = [];
        
        for (let i = 0; i < 15; i++) {
          const roll = rollOnce();
          multiRolls.push(roll.inventoryData);
          
          let displayResult = roll.result.replace(/ROLLINDEX/g, i.toString()).replace(/RANKBUTTON/g, roll.inventoryData ? 
            `<button class="rank-button" id="rank-btn-${i}" onclick="acceptRoll(${i})">${roll.inventoryData.rank}</button>` : 
            '???');
          
          output += `<div class="roll-line">${displayResult}</div>`;
          if (roll.cooldown > maxCooldown) maxCooldown = roll.cooldown;
        }
        
        resultsDiv.innerHTML = output;
        if (maxCooldown > 0) setCooldown(maxCooldown);
      });

      window.acceptRoll = acceptRoll;

      // Initialize
      loadDiscovered();
      loadInventory();
    </script>
  </body>
</html>
